window.Layoutline=function(e,t){var n=this;window.onkeypress=function(e){n.keyPressed.call(n,e)};if(e&&t){if(window===this)return new window.Layoutline(e,t);this.delay=t;this.layouts=e;this.before=0;this.chain=0;this.chains=[];this.precision=[];return this}};window.Layoutline.prototype={getPredictedLayout:function(){var e=this.getPrecision();return this.layouts[e.indexOf(Math.max.apply(Math,e))]},getPosition:function(e,t,n){for(row in t){for(cha in t[row]){if(t[row][cha]===e){return[parseFloat(cha)+n[row],parseFloat(row)]}}}return null},getPrecision:function(){var e=[];for(p in this.precision){for(layout in this.layouts){if(e.length<=layout)e.push(undefined);if(this.precision[p][layout]===null)e[layout]=null;if(e[layout]!==null){if(e[layout]===undefined)e[layout]=this.precision[p][layout];e[layout]=(e[layout]+this.precision[p][layout])/2}}}return e},keyPressed:function(e){var t=Date.now(),n=String.fromCharCode(e.which).toLowerCase();if(t-this.before<=this.delay){this.chains[this.chain-1].push(n)}else{this.chains.push([n]);this.chain+=1}this.updatePrecision(this.chains[this.chain-1],this.chains.length-1);this.before=t},updatePrecision:function(e,t){if(this.precision.length<=t)this.precision.push([]);for(layout in this.layouts){if(this.precision[t].length<=layout)this.precision[t].push(undefined);if(e.length>1){var n=this.layouts[layout]["layout"],r=this.layouts[layout]["offsets"],i=this.getPosition(e[e.length-2],n,r),s=this.getPosition(e[e.length-1],n,r);if(i&&s){var o=Math.sqrt(Math.pow(s[0]-i[0],2)+Math.pow(s[1]-i[1],2));if(this.precision[t][layout]===undefined)this.precision[t][layout]=1/o;this.precision[t][layout]=(this.precision[t][layout]+1/o)/2}else this.precision[t][layout]=null}}}}
