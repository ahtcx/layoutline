<html>
	<head>
		<meta charset="utf-8">
		<title>Layoutline</title>
		<script src="https://rawgit.com/zeokila/layoutline/master/layoutline.js"></script>
		<script src="https://rawgit.com/zeokila/layoutline/master/layouts.js"></script>
		<script type="text/javascript">
			var blankLayout = {
				'name': 'blank',
				'layout': [
					['','','','','','','','','','','','',''],
					['','','','','','','','','','','','',''],
					['','','','','','','','','','',''],
					['','','','','','','','','','']
				],
				'offsets': [0, 1.5, 1.75, 2.25]
			}
		
			var ll = new window.Layoutline(layouts, 200),
				currentLayout = blankLayout,
				canvas,
				context,
				keyboardElement,
				size = 60,
				xOff,
				yOff,
				a,
				advancedElement,
				info;
				
			window.onload = function() {
				canvas = document.getElementById('trail'),
				context = canvas.getContext('2d');
				keyboardElement = document.getElementById('keyboard');
				advancedElement = document.getElementById('advanced');
				info = document.getElementById('info');
				
				advancedElement.onchange = function(event) { advanced(event.srcElement.checked); }
			}
			
			window.onkeypress = function(event) { ll.keyPressed(String.fromCharCode(event.which).toLowerCase(), ll); update(); };
			
			window.onresize = function() {
				canvas.style.left = keyboardElement.offsetLeft;
				canvas.style.top = keyboardElement.offsetTop;
			}
			
			function advanced(bool) {
				if(bool){
					canvas.style.display = 'initial';
					info.style.display = 'initial';
				} else {
					canvas.style.display = 'none';
					info.style.display = 'none';
				}
			}
			
			function update() {
				var predicted = ll.getPredictedLayout();
				if(predicted !== currentLayout && predicted) {
					layoutToHtml(predicted);
					currentLayout = predicted;
					xOff = size / 2;
					yOff = size / 2;
				}
				if(ll.chains.length >= 1) {
					if(ll.chains[ll.chains.length - 1].length > 1){
						var first = ll.getPosition(ll.chains[ll.chains.length - 1][ll.chains[ll.chains.length - 1].length - 2], currentLayout.layout, currentLayout.offsets),
							second = ll.getPosition(ll.chains[ll.chains.length - 1][ll.chains[ll.chains.length - 1].length - 1], currentLayout.layout, currentLayout.offsets);
						context.beginPath();
						context.moveTo(xOff + first[0] * size, yOff + first[1] * size);
						context.lineTo(xOff + second[0] * size, yOff + second[1] * size);
						context.arc(xOff + first[0] * size, yOff + first[1] * size, 2, 0, 2 * Math.PI);
						context.arc(xOff + second[0] * size, yOff + second[1] * size, 2, 0, 2 * Math.PI);
						context.stroke();
					}
				}
				var precision = ll.getPrecision();
				info.innerHTML = '';
				if(precision.length > 0) {
					for(layout in layouts){
						info.innerHTML += layouts[layout]['name'] + ':' + precision[layout] + '<br/>';
					}
				}
			}
			
			function layoutToHtml(layout) {
				var rows = layout.layout;
				keyboardElement.innerHTML = '';
				for(row in rows) {
					var p = document.createElement('p');
					p.setAttribute('class', 'row');
					p.setAttribute('style', 'margin-left: calc(' + layout.offsets[row] + ' * (36px + 1em));');
					for(character in rows[row]) {
						var span = document.createElement('span');
						span.innerHTML = rows[row][character];
						p.appendChild(span);
					}
					keyboardElement.appendChild(p);
				}
				canvas.style.left = keyboardElement.offsetLeft;
				canvas.style.top = keyboardElement.offsetTop;
				context.canvas.width = keyboardElement.offsetWidth;
				context.canvas.height = keyboardElement.offsetHeight;
			}
		</script>
		<style>
			body {
				background: #923;
				margin: 0;
			}
		
			* {
				font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
				font-weight: 100;
				color: #fff;
				text-shadow: 0 1px 0 #000;
				text-align: center;
			}
			
			header > h1 {
				font-size: 48px;
				line-height: 48px;
				margin: 24px 0;
				display: inline-block;
				width: 100%;
			}
			
			header > h4 {
				font-size: 18px;
				line-height: 18px;
				margin: 0;
			}
			
			main {
				position: absolute;
				width: 100%;
				top: 120px;
				bottom: 3em;
				overflow: auto;
			}
			
			main:before {
				content: '';
				display: inline-block;
				height: 100%;
				vertical-align: middle;
			}
			
			#keyboard {
				display: inline-block;
				vertical-align: middle;
			}
			
			#keyboard > p.row {
				display: flex;
				margin: 0;
			}
			
			#keyboard > p.row > span {
				margin: 4px;
				width: 18px;
				height: 18px;
				display: inline-block;
				padding: 16px;
				border: 1px solid #fff;
				border-radius: 6px;
			}
			
			#trail {
				display: none;
				position: absolute;
			}
			
			footer {
				position: absolute;
				width: 100%;
				bottom: 0;
			}
			
			#info {
				display: none;
				position: absolute;
				top: 0;
				left: 0;
				font-family: monospace;
				text-align: left;
			}
		</style>
	</head>
	<body onload="layoutToHtml(blankLayout);">
		<div id="info"></div>
		<header>
			<h1>Layoutline</h1>
			<h4>Swipe lines on your keyboard to find out your layout!</h4>
		</header>
		<main>
			<div id="keyboard"></div>
			<canvas id="trail"></canvas>
		</main>
		<footer>
			<p>Created by <a href="/">Alexandre Hitchcox</a> — <a href="https://github.com/zeokila/layoutline">Source</a> — <input id="advanced" type="checkbox">Advanced mode</p>
		</footer>
	</body>
</html>
